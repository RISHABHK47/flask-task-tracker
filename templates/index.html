{% extends "base.html" %}
{% block content %}

<!-- Add Task Section -->
<div class="add-task-section">
  <h2 class="section-title">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    Create New Task
  </h2>
  
  <form action="{{ url_for('add_task') }}" method="post" class="task-form" id="addTaskForm">
    <div class="form-group">
      <label for="title" class="form-label">
        Task Title
        <span class="required">*</span>
      </label>
      <input 
        type="text" 
        id="title"
        name="title" 
        class="form-input" 
        placeholder="e.g., Complete project documentation" 
        required
        minlength="3"
        maxlength="200"
        autocomplete="off"
        pattern="[A-Za-z0-9\s.,!?\-_()[\]{}:;&quot;']+"
        title="Title must be 3-200 characters and contain only letters, numbers, spaces, and common punctuation"
      >
      <span class="field-error" id="title-error"></span>
    </div>
    
    <div class="form-group">
      <label for="description" class="form-label">Description (Optional)</label>
      <textarea 
        id="description"
        name="description" 
        class="form-textarea" 
        placeholder="Add more details about your task..."
        rows="3"
        maxlength="1000"
      ></textarea>
      <span class="field-hint">Maximum 1000 characters</span>
    </div>

    <!-- Two Column Layout for Priority and Status -->
    <div class="form-row">
      <div class="form-group">
        <label for="priority" class="form-label">
          Priority
          <span class="optional-badge">Optional</span>
        </label>
        <select 
          id="priority"
          name="priority" 
          class="form-select"
        >
          <option value="">Select Priority (Optional)</option>
          <option value="Low">üü¢ Low Priority</option>
          <option value="Medium">üü° Medium Priority</option>
          <option value="High">üî¥ High Priority</option>
        </select>
      </div>

      <div class="form-group">
        <label for="status" class="form-label">
          Status
          <span class="optional-badge">Optional</span>
        </label>
        <select 
          id="status"
          name="status" 
          class="form-select"
        >
          <option value="">Select Status (Optional)</option>
          <option value="Not Started">üìã Not Started</option>
          <option value="In Progress">‚öôÔ∏è In Progress</option>
          <option value="Completed">‚úÖ Completed</option>
        </select>
      </div>
    </div>

    <!-- Two Column Layout for Due Date and Duration -->
    <div class="form-row">
      <div class="form-group">
        <label for="due_date" class="form-label">
          Due Date
          <span class="optional-badge">Optional</span>
        </label>
        <input 
          type="date" 
          id="due_date"
          name="due_date" 
          class="form-input"
          min="{{ (now or '')|default('', true) }}"
        >
        <span class="field-error" id="due-date-error"></span>
      </div>

      <div class="form-group">
        <label for="duration" class="form-label">
          Duration (Days)
          <span class="optional-badge">Optional</span>
        </label>
        <input 
          type="number" 
          id="duration"
          name="duration" 
          class="form-input"
          placeholder="e.g., 5"
          min="1"
          max="365"
        >
        <span class="field-hint">Number of days to complete</span>
      </div>
    </div>
    
    <button type="submit" class="btn btn-primary btn-block">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M10 4V16M4 10H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      Add Task
    </button>
  </form>
</div>

<!-- Task Stats -->
{% if tasks %}
<div class="task-stats">
  <div class="stat-card">
    <div class="stat-icon stat-total">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9 5H7C5.89543 5 5 5.89543 5 7V19C5 20.1046 5.89543 21 7 21H17C18.1046 21 19 20.1046 19 19V7C19 5.89543 18.1046 5 17 5H15M9 5C9 6.10457 9.89543 7 11 7H13C14.1046 7 15 6.10457 15 5M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </div>
    <div class="stat-content">
      <div class="stat-value">{{ tasks|length }}</div>
      <div class="stat-label">Total Tasks</div>
    </div>
  </div>
  
  <div class="stat-card">
    <div class="stat-icon stat-completed">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <div class="stat-content">
      <div class="stat-value">{{ tasks|selectattr('completed')|list|length }}</div>
      <div class="stat-label">Completed</div>
    </div>
  </div>
  
  <div class="stat-card">
    <div class="stat-icon stat-pending">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 8V12L15 15M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <div class="stat-content">
      <div class="stat-value">{{ tasks|rejectattr('completed')|list|length }}</div>
      <div class="stat-label">Pending</div>
    </div>
  </div>
</div>
{% endif %}

<!-- Tasks List Section -->
<div class="tasks-section">
  <div class="section-header">
    <h2 class="section-title">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9 5H7C5.89543 5 5 5.89543 5 7V19C5 20.1046 5.89543 21 7 21H17C18.1046 21 19 20.1046 19 19V7C19 5.89543 18.1046 5 17 5H15M9 5C9 6.10457 9.89543 7 11 7H13C14.1046 7 15 6.10457 15 5M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Your Tasks
    </h2>
    {% if tasks %}
    <span class="task-count">{{ tasks|length }} {{ 'task' if tasks|length == 1 else 'tasks' }}</span>
    {% endif %}
  </div>

  {% if tasks %}
    <ul class="task-list">
      {% for t in tasks %}
      <li class="task-item {% if t.completed %}task-completed{% endif %}">
        <form action="{{ url_for('toggle_task', task_id=t.id) }}" method="post" class="task-checkbox-form">
          <button type="submit" class="checkbox-btn" aria-label="Toggle task completion">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              {% if t.completed %}
                <rect width="20" height="20" rx="6" fill="url(#gradient)"/>
                <path d="M6 10L9 13L14 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              {% else %}
                <rect x="1" y="1" width="18" height="18" rx="5" stroke="currentColor" stroke-width="2" fill="none"/>
              {% endif %}
              <defs>
                <linearGradient id="gradient" x1="0" y1="0" x2="20" y2="20" gradientUnits="userSpaceOnUse">
                  <stop stop-color="#6366F1"/>
                  <stop offset="1" stop-color="#8B5CF6"/>
                </linearGradient>
              </defs>
            </svg>
          </button>
        </form>

        <div class="task-content">
          <h3 class="task-title">{{ t.title }}</h3>
          {% if t.description %}
            <p class="task-description">{{ t.description }}</p>
          {% endif %}
          
          <!-- Task Details -->
          <div class="task-details">
            <!-- Status Badge -->
            {% if t.status %}
            <div class="task-detail-item">
              <span class="status-badge status-{{ t.status|lower|replace(' ', '-') }}">
                {% if t.status == "Not Started" %}üìã
                {% elif t.status == "In Progress" %}‚öôÔ∏è
                {% elif t.status == "Completed" %}‚úÖ
                {% endif %}
                {{ t.status }}
              </span>
            </div>
            {% endif %}
            
            <!-- Priority Badge -->
            {% if t.priority %}
            <div class="task-detail-item">
              <span class="priority-badge priority-{{ t.priority|lower }}">
                {% if t.priority == "High" %}üî¥{% elif t.priority == "Medium" %}üü°{% else %}üü¢{% endif %}
                {{ t.priority }}
              </span>
            </div>
            {% endif %}
            
            <!-- Due Date -->
            {% if t.due_date %}
            <div class="task-detail-item">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="2" y="3" width="10" height="10" rx="1.5" stroke="currentColor" stroke-width="1.2"/>
                <path d="M2 6H12M5 1.5V4.5M9 1.5V4.5" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
              </svg>
              <span>Due: {{ t.due_date }}</span>
            </div>
            {% endif %}
            
            <!-- Duration -->
            {% if t.duration %}
            <div class="task-detail-item">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M7 3.5V7L9.5 8.5M13 7C13 10.3137 10.3137 13 7 13C3.68629 13 1 10.3137 1 7C1 3.68629 3.68629 1 7 1C10.3137 1 13 3.68629 13 7Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>{{ t.duration }} {{ 'day' if t.duration == 1 else 'days' }}</span>
            </div>
            {% endif %}
            
            <!-- Days Left -->
            {% if t.days_left != None %}
            <div class="task-detail-item">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M7 1V7L10 10M13 7C13 10.3137 10.3137 13 7 13C3.68629 13 1 10.3137 1 7C1 3.68629 3.68629 1 7 1C10.3137 1 13 3.68629 13 7Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>
                {% if t.days_left < 0 %}
                  <span style="color: #ef4444; font-weight: 600;">Overdue ({{ t.days_left|abs }} days)</span>
                {% elif t.days_left == 0 %}
                  <span style="color: #f59e0b; font-weight: 600;">Due Today</span>
                {% elif t.days_left <= 3 %}
                  <span style="color: #f59e0b; font-weight: 600;">{{ t.days_left }} {{ 'day' if t.days_left == 1 else 'days' }} left</span>
                {% else %}
                  {{ t.days_left }} {{ 'day' if t.days_left == 1 else 'days' }} left
                {% endif %}
              </span>
            </div>
            {% endif %}
          </div>
          
          <!-- Created At -->
          <div class="task-meta">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 3.5V7L9.5 8.5M13 7C13 10.3137 10.3137 13 7 13C3.68629 13 1 10.3137 1 7C1 3.68629 3.68629 1 7 1C10.3137 1 13 3.68629 13 7Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>{{ t.created_at.strftime("%b %d, %Y at %I:%M %p") }}</span>
          </div>
        </div>

        <div class="task-actions">
          <a href="{{ url_for('edit_task', task_id=t.id) }}" class="btn btn-sm btn-secondary" title="Edit task">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M11.333 2.00004C11.5081 1.82494 11.716 1.68605 11.9447 1.59129C12.1735 1.49653 12.4187 1.44775 12.6663 1.44775C12.914 1.44775 13.1592 1.49653 13.3879 1.59129C13.6167 1.68605 13.8246 1.82494 13.9997 2.00004C14.1748 2.17513 14.3137 2.383 14.4084 2.61178C14.5032 2.84055 14.552 3.08575 14.552 3.33337C14.552 3.58099 14.5032 3.82619 14.4084 4.05497C14.3137 4.28374 14.1748 4.49161 13.9997 4.66671L5.33301 13.3334L1.33301 14.6667L2.66634 10.6667L11.333 2.00004Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Edit
          </a>
          
          <form action="{{ url_for('delete_task', task_id=t.id) }}" method="post" class="delete-form" onsubmit="return confirm('Are you sure you want to delete this task?');">
            <button type="submit" class="btn btn-sm btn-danger" title="Delete task">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M2 4H3.33333H14M5.33333 4V2.66667C5.33333 2.31304 5.47381 1.97391 5.72386 1.72386C5.97391 1.47381 6.31304 1.33333 6.66667 1.33333H9.33333C9.68696 1.33333 10.0261 1.47381 10.2761 1.72386C10.5262 1.97391 10.6667 2.31304 10.6667 2.66667V4M12.6667 4V13.3333C12.6667 13.687 12.5262 14.0261 12.2761 14.2761C12.0261 14.5262 11.687 14.6667 11.3333 14.6667H4.66667C4.31304 14.6667 3.97391 14.5262 3.72386 14.2761C3.47381 14.0261 3.33333 13.687 3.33333 13.3333V4H12.6667Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Delete
            </button>
          </form>
        </div>
      </li>
      {% endfor %}
    </ul>
  {% else %}
    <div class="empty-state">
      <svg class="empty-state-icon" width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="40" cy="40" r="38" stroke="currentColor" stroke-width="4" stroke-dasharray="8 8"/>
        <path d="M40 20V60M20 40H60" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
      </svg>
      <h3 class="empty-state-title">No tasks yet</h3>
      <p class="empty-state-description">Get started by creating your first task above!</p>
    </div>
  {% endif %}
</div>

{% endblock %}